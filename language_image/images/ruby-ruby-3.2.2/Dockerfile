# syntax=docker/dockerfile:1.4.1

# generated by dockerfile_gen.py

# DOCKER_BUILDKIT=1 docker build ...

FROM ubuntu:23.04

SHELL ["/bin/bash", "-c"]

RUN apt-get update

RUN apt install sudo adduser

RUN adduser runner && \
    echo '%runner ALL=(ALL) NOPASSWD:ALL' >> /etc/sudoers
USER runner

RUN sudo ln -sf /usr/share/zoneinfo/Asia/Tokyo /etc/localtime
ENV DEBIAN_FRONTEND=noninteractive DEBCONF_NONINTERACTIVE_SEEN=true

RUN sudo apt install -y wget unzip xz-utils curl

RUN sudo mkdir /judge --mode=777

WORKDIR /judge


RUN <<EOF
sudo apt-get install -y autoconf bison patch build-essential rustc libssl-dev libyaml-dev libreadline6-dev zlib1g-dev libgmp-dev libncurses5-dev libffi-dev libgdbm6 libgdbm-dev libdb-dev uuid-dev make
cd /tmp
wget https://cache.ruby-lang.org/pub/ruby/3.2/ruby-3.2.2.tar.gz
tar -xf ruby-3.2.2.tar.gz
cd ruby-3.2.2
export cflags=-fno-stack-clash-protection
./configure
make
sudo make install
# 以下、Library のインストール
sudo gem install rbtree
sudo gem install ac-library-rb
sudo gem install faster_prime
sudo gem install sorted_set
sudo gem install numo-narray
sudo gem install polars-df

EOF



COPY --chmod=777 run.bash /tmp/run.bash
