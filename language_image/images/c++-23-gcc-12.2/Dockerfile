# syntax=docker/dockerfile:1.4.1

# generated by dockerfile_gen.py

# DOCKER_BUILDKIT=1 docker build ...

FROM ubuntu:23.04

SHELL ["/bin/bash", "-c"]

RUN apt-get update

RUN apt install sudo adduser

RUN adduser runner && \
    echo '%runner ALL=(ALL) NOPASSWD:ALL' >> /etc/sudoers
USER runner

RUN sudo ln -sf /usr/share/zoneinfo/Asia/Tokyo /etc/localtime
ENV DEBIAN_FRONTEND=noninteractive DEBCONF_NONINTERACTIVE_SEEN=true

RUN sudo apt install -y wget unzip xz-utils curl

RUN sudo mkdir /judge --mode=777

WORKDIR /judge


RUN <<EOF
sudo apt install -y g++-12

#GMP
sudo apt install -y libgmp3-dev

cd /tmp

# ac library
sudo mkdir /opt/ac-library
wget https://github.com/atcoder/ac-library/releases/download/v1.5.1/ac-library.zip -O ac-library.zip
sudo unzip /tmp/ac-library.zip -d /opt/ac-library

# boost
sudo apt install -y build-essential
wget https://boostorg.jfrog.io/artifactory/main/release/1.82.0/source/boost_1_82_0.tar.gz -O boost_1_82_0.tar.gz
tar xf boost_1_82_0.tar.gz
cd boost_1_82_0
./bootstrap.sh --with-toolset=gcc --without-libraries=mpi,graph_parallel
./b2 -j3 toolset=gcc variant=release link=static runtime-link=static cxxflags="-std=c++2b" stage
sudo ./b2 -j3 toolset=gcc variant=release link=static runtime-link=static cxxflags="-std=c++2b" --prefix=/opt/boost/gcc install

#Eigen
sudo apt install -y libeigen3-dev=3.4.0-4

EOF



COPY --chmod=777 run.bash /tmp/run.bash
