# syntax=docker/dockerfile:1.4.1

# generated by dockerfile_gen.py

# DOCKER_BUILDKIT=1 docker build ...

FROM ubuntu:23.04

SHELL ["/bin/bash", "-c"]

RUN apt-get update

RUN apt install sudo adduser

RUN adduser runner && \
    echo '%runner ALL=(ALL) NOPASSWD:ALL' >> /etc/sudoers
USER runner

RUN sudo ln -sf /usr/share/zoneinfo/Asia/Tokyo /etc/localtime
ENV DEBIAN_FRONTEND=noninteractive DEBCONF_NONINTERACTIVE_SEEN=true

RUN sudo apt install -y wget unzip xz-utils curl

RUN sudo mkdir /judge --mode=777

WORKDIR /judge


RUN <<EOF

sudo apt-get install unzip
curl -fsSL https://deno.land/install.sh | sh -s v1.35.1
export NO_COLOR=true
export DENO_NO_UPDATE_CHECK=1
export PATH=$PATH:/home/runner/.deno/bin

deno cache npm:mathjs@11.8.2
# deno_stdをキャッシュに入れておく。
cd /tmp
wget https://github.com/denoland/deno_std/archive/refs/tags/0.194.0.tar.gz
tar xf 0.194.0.tar.gz
find deno_std-0.194.0 -name "*.ts" >> stdfiles
find deno_std-0.194.0 -name "*.js" >> stdfiles
sed -i -e "s%deno_std-\(.*\)%import 'https://deno.land/std@\1';%" stdfiles
deno cache stdfiles

EOF



COPY --chmod=777 run.bash /tmp/run.bash
