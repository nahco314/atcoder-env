# syntax=docker/dockerfile:1.4.1

# generated by dockerfile_gen.py

# DOCKER_BUILDKIT=1 docker build ...

FROM ubuntu:23.04

SHELL ["/bin/bash", "-c"]

RUN apt-get update

RUN apt install sudo adduser

RUN adduser runner && \
    echo '%runner ALL=(ALL) NOPASSWD:ALL' >> /etc/sudoers
USER runner

RUN sudo ln -sf /usr/share/zoneinfo/Asia/Tokyo /etc/localtime
ENV DEBIAN_FRONTEND=noninteractive DEBCONF_NONINTERACTIVE_SEEN=true

RUN sudo apt install -y wget unzip xz-utils curl

RUN sudo mkdir /judge --mode=777

WORKDIR /judge


RUN <<EOF

sudo apt update
sudo apt install -y ansifilter
cd /tmp
NODE_VERSION=18.16.1
wget https://nodejs.org/dist/v$NODE_VERSION/node-v$NODE_VERSION-linux-x64.tar.xz
sudo tar -C /opt -xf node-v$NODE_VERSION-linux-x64.tar.xz
sudo ln -s /opt/node-v$NODE_VERSION-linux-x64/bin/node /usr/local/bin
sudo ln -s /opt/node-v$NODE_VERSION-linux-x64/bin/npm /usr/local/bin
sudo ln -s /opt/node-v$NODE_VERSION-linux-x64/bin/npx /usr/local/bin
sudo npm install -g typescript@5.1.6
sudo npm install -g tstl@2.5.13
sudo npm install -g mathjs@11.8.2
sudo npm install -g @types/node@18.16.18
sudo ln -s /opt/node-v$NODE_VERSION-linux-x64/bin/tsc /usr/local/bin
sudo ln -s /opt/node-v$NODE_VERSION-linux-x64/lib/node_modules /node_modules

EOF



COPY --chmod=777 run.bash /tmp/run.bash
